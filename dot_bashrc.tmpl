## Non-interactive settings should go up here

. "$HOME/.local/lib/rbm/utils.sh"
# This is mostly to ensure that my local bin paths is available in `ssh`
# e.g. `ssh user@host 'script --arg'`
# Such shells in at least `openssh` hardcode `PATH`
# Perhaps `ssh user@host 'bash -c "script --arg"'` should work instead of this,
# but that's a shell-quoting nightmare isn't it?
pathmunge "$HOME/devbox/bin"
pathmunge "$HOME/.local/bin"

# Enable the subsequent settings only in interactive sessions
case $- in
  *i*) ;;
  *) return ;;
esac

shopt -s globstar
shopt -s extglob

export BAT_CONFIG_PATH="$HOME/.config/bat.conf"
export FZF_DEFAULT_OPTS=" \
--color=bg+:#414559,bg:#303446,spinner:#f2d5cf,hl:#e78284 \
--color=fg:#c6d0f5,header:#e78284,info:#ca9ee6,pointer:#f2d5cf \
--color=marker:#f2d5cf,fg+:#c6d0f5,prompt:#ca9ee6,hl+:#e78284"
export LG_CONFIG_FILE="$HOME/.config/lazygit/config.yml,$HOME/.config/lazygit/themes/catppuccin/macchiato/blue.yml"
export MANPAGER="sh -c 'col -bx | bat -l man -p'"

alias nneovide="NEOVIM_BIN=$HOME/.local/bin/nvim-nightly neovide"
alias nnvim="nvim-nightly"
alias vim="nvim"

alias cat="bat"
alias ls="eza"
alias dev="distrobox enter dev"

bhelp() {
  "$@" --help 2>&1 | bat --plain --language=help
}

if [[ $CONTAINER_ID = "dev" ]]; then
  YAZI_TERM=""
  if [ -n "$YAZI_LEVEL" ]; then
    YAZI_TERM="| îž• Yazi terminal: "
  fi
  PS1="$PS1$YAZI_TERM"

  source "$HOME/devbox/local/share/blesh/ble.sh" \
    --noattach \
    --rcfile ~/.config/ble.rc

  setup_atuin() {
    source <(atuin init bash)
    out=$HOME/.local/etc/bash_completion.d/
    if ! [[ -r $out/atuin.bash ]]; then
      atuin gen-completions --shell bash --out-dir "$out"
    fi
  }

  setup_atuin

  source <(mise activate bash)
  source <(starship init bash)
  source <(zoxide init --cmd cd bash)

  alias curlie='curlie --curl'

fi

[[ ${BLE_VERSION-} ]] && ble-attach
