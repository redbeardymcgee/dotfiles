# Put this above the interactive session check
# This allows `ssh foo@bar <command>` to resolve 
# <command> from "$HOME"

if [[ -r $HOME/.local/lib/rbm/utils.sh ]]; then
  source "$HOME/.local/lib/rbm/utils.sh"

  prepend_to_PATH "$HOME/.local/bin"
  prepend_to_PATH "$HOME/.cargo/bin"

  {{ if eq .chezmoi.hostname "rbmpc" "media" }}
  prepend_to_PATH "$HOME/devbox/.local/bin"
  {{ end }}

fi

# Enable the subsequent settings only in interactive sessions
case $- in
*i*) ;;
*) return ;;
esac

shopt -s globstar

{{ if eq .chezmoi.fqdnHostname "media" }}
source <(ssh-agent -s)
ssh-add ~/.ssh/github
{{ end }}

type -p chezmoi > /dev/null && chezmoi update

export BAT_CONFIG_PATH="$HOME/.config/bat.conf"
export FZF_DEFAULT_OPTS=" \
--color=bg+:#414559,bg:#303446,spinner:#f2d5cf,hl:#e78284 \
--color=fg:#c6d0f5,header:#e78284,info:#ca9ee6,pointer:#f2d5cf \
--color=marker:#f2d5cf,fg+:#c6d0f5,prompt:#ca9ee6,hl+:#e78284"
export LG_CONFIG_FILE="$HOME/.config/lazygit/config.yml,$HOME/.config/lazygit/themes/catppuccin/macchiato/blue.yml"
export MANPAGER="sh -c 'col -bx | bat -l man -p'"

bhelp() {
	"$@" --help 2>&1 | bathelp
}

alias nneovide="NEOVIM_BIN=$HOME/.local/bin/nvim-nightly neovide"
alias nnvim="nvim-nightly"
alias vim="nvim"

alias bathelp='bat --plain --language=help'
alias cat="bat"
alias ls='eza'

{{ if not (hasPrefix "dev" .chezmoi.hostname) }}
alias dev="distrobox enter dev"
{{ end }}

{{ if hasPrefix "dev" .chezmoi.fqdnHostname }}
source ~/.local/share/blesh/ble.sh \
	--noattach \
	--rcfile ~/.config/ble.rc

setup_atuin() {
	source <(atuin init bash)
	out=$HOME/.local/etc/bash_completion.d/
	if ! [[ -r $out/atuin.bash ]]; then
		atuin gen-completions --shell bash --out-dir "$out"
	fi
}

source <(mise activate bash)
source <(starship init bash)

setup_atuin
{{ end }}

[[ ${BLE_VERSION-} ]] && ble-attach
